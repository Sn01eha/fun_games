<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ topic }} Quiz - BrainBreeze</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <h1>Answer the questions for: {{ topic }}</h1>
        <form id="quizForm" action="{{ url_for('submit_quiz') }}" method="post">
            <!-- Hidden input to pass the topic back to the server -->
            <input type="hidden" name="topic" value="{{ topic }}">

            {% for question in questions %}
	    {% set question_index = loop.index0 %}
                <div class="question-block">
                    <p class="question-text">{{ loop.index0 + 1 }}. {{ question.question }}</p>
                    <div class="options-container" data-question-index="{{ question_index }}">
                        {% for option in question.options %}
                            <label class="option-label">
                                <input type="radio"
                                       name="question_{{ question_index }}" 
                                       value="{{ option }}"
                                       required>
                                {{ option }}
                            </label>
                        {% endfor %}
                    </div>
                </div>
            {% endfor %}
            <button type="submit" class="submit-quiz-button">Submit Quiz</button>
        </form>
        <a href="{{ url_for('topics') }}" class="back-button">Back to Topics</a>
    </div>

    <script>
        // All custom JavaScript for handling radio button selection/deselection has been removed.
        // The native behavior of HTML radio buttons (when they share the same 'name' attribute)
        // automatically ensures that only one option can be selected within that group.
        // The 'required' attribute on the radio inputs also helps with basic browser-level validation.

        // This script still handles the overall form submission validation,
        // checking if at least one option is selected for each question.
        document.getElementById('quizForm').addEventListener('submit', function(event) {
            const questionBlocks = this.querySelectorAll('.question-block');
            let allQuestionsAnswered = true;
            let firstUnansweredQuestion = -1;

            questionBlocks.forEach((block, index) => {
                // Select all radio buttons belonging to this specific question
                const radiosInQuestion = block.querySelectorAll(`input[name="question_${index}"]`);
                let answeredForThisQuestion = false;

                // Check if any radio button in this question's group is checked
                radiosInQuestion.forEach(radio => {
                    if (radio.checked) {
                        answeredForThisQuestion = true;
                    }
                });

                if (!answeredForThisQuestion) {
                    allQuestionsAnswered = false;
                    if (firstUnansweredQuestion === -1) {
                        firstUnansweredQuestion = index;
                    }
                }
            });

            if (!allQuestionsAnswered) {
                event.preventDefault(); // Prevent default form submission if not all questions are answered

                // Display a custom message box instead of the browser's native alert()
                const messageBox = document.createElement('div');
                messageBox.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background-color: #34495e; /* Dark blue-gray */
                    color: #ecf0f1; /* Light gray text */
                    padding: 25px 35px;
                    border-radius: 10px;
                    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
                    z-index: 1000;
                    text-align: center;
                    font-size: 1.1em;
                    max-width: 350px;
                    width: 90%;
                `;
                messageBox.innerHTML = `
                    <p>Please answer all questions before submitting the quiz.</p>
                    <button id="messageBoxOk" style="
                        background-color: #e67e22; /* Orange */
                        color: white;
                        padding: 10px 20px;
                        border: none;
                        border-radius: 5px;
                        margin-top: 20px;
                        cursor: pointer;
                        font-size: 1em;
                        transition: background-color 0.3s ease;
                    ">OK</button>
                `;
                document.body.appendChild(messageBox);

                // Add event listener to the "OK" button in the custom message box
                document.getElementById('messageBoxOk').onclick = function() {
                    messageBox.remove(); // Remove the message box when "OK" is clicked
                    // Optional: Scroll to the first unanswered question for better UX
                    if (firstUnansweredQuestion !== -1) {
                        const targetQuestionBlock = document.querySelector(`.question-block:nth-child(${firstUnansweredQuestion + 1})`);
                        if (targetQuestionBlock) {
                            targetQuestionBlock.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                    }
                };
            }
        });
    </script>
</body>
</html>

